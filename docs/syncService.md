# üîÑ –°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ IndexedDB

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É REST API —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö IndexedDB –¥–ª—è React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å TypeScript.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)  
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#Ô∏è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#Ô∏è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [Troubleshooting](#-troubleshooting)
- [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É REST API –∏ –ª–æ–∫–∞–ª—å–Ω–æ–π IndexedDB —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, offline-—Ä–µ–∂–∏–º–∞ –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç-—Ä–µ–∑–æ–ª—é—Ü–∏–∏.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- üìä **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- üéØ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚ö° **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- üõ°Ô∏è **TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
- üîß **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –ë–î** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- üì± **Reactive UI** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- üé® **–ì–æ—Ç–æ–≤—ã–µ —Ö—É–∫–∏** - –ø—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üèóÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

1. **–ï–¥–∏–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä IndexedDB
2. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **Server-wins —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** - —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö
4. **Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —á–µ—Ä–µ–∑ callback'–∏
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–¥** - –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Layered Architecture**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    UI Layer                             ‚îÇ ‚Üê React Components
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                   Hooks Layer                           ‚îÇ ‚Üê useSyncData, useIndexedDBData
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                Business Logic Layer                     ‚îÇ ‚Üê SyncUtils
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                   Core Layer                            ‚îÇ ‚Üê SyncManager, DbClient, ApiClient
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 Storage Layer                           ‚îÇ ‚Üê IndexedDB, localStorage
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîó –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

```mermaid
graph TD
    A[React Component] --> B[useSyncData Hook]
    B --> C[SyncUtils]
    C --> D[SyncManager]
    D --> E[DbClient]
    D --> F[ApiClient]
    E --> G[DatabaseVersionManager]
    G --> H[IndexedDB]
    F --> I[REST API]
    C --> J[localStorage]
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **React** 16.8+ (–¥–ª—è —Ö—É–∫–æ–≤)
- **TypeScript** 4.0+
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π IndexedDB
- **REST API** —Å–µ—Ä–≤–µ—Ä —Å endpoints –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç:

```
src/
‚îú‚îÄ‚îÄ dataSync/                           # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ apiClient.ts               # HTTP –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dbClient.ts                # IndexedDB –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ syncManager.ts             # –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ syncUtils.ts               # –£—Ç–∏–ª–∏—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ syncTypes.ts               # TypeScript —Ç–∏–ø—ã
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                       # –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Å–ø–æ—Ä—Ç
‚îî‚îÄ‚îÄ hooks/
    ‚îú‚îÄ‚îÄ useSyncData.ts                 # –ì–ª–∞–≤–Ω—ã–π —Ö—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    ‚îî‚îÄ‚îÄ useIndexedDBData.ts            # –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞

–í–∞—à —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

#### GET `/api/sync/table-versions`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü:
```json
{
  "success": true,
  "versions": {
    "users": "v1.2",
    "orders": "v1.5",
    "products": "v2.0"
  }
}
```

#### GET `/api/sync?tables=X&since=Y`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:
```json
{
  "success": true,
  "timestamp": "2025-06-04T12:00:00.000Z",
  "changes": {
    "users": {
      "inserted": [...],
      "updated": [...],
      "deleted": [...]
    }
  }
}
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```typescript
// config/syncConfig.ts
import { SyncConfig } from '../dataSync';

export const mySyncConfig: SyncConfig = {
  tables: ['users', 'orders', 'products'],
  apiBaseUrl: 'https://api.example.com',
  displayName: '–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
  description: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∑–∞–∫–∞–∑—ã –∏ —Ç–æ–≤–∞—Ä—ã'
};
```

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

```typescript
// components/UsersList.tsx
import React, { useEffect } from 'react';
import { useSyncData } from '../hooks/useSyncData';
import { mySyncConfig } from '../config/syncConfig';

const UsersList: React.FC = () => {
  const {
    tableData,
    isInitialized,
    isLoading,
    sync,
    error
  } = useSyncData(mySyncConfig, {
    autoInitialize: true,
    autoSync: true
  });

  const users = tableData?.users || [];

  if (!isInitialized) return <div>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>;
  if (isLoading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  if (error) return <div>–û—à–∏–±–∫–∞: {error}</div>;

  return (
    <div>
      <button onClick={sync}>–û–±–Ω–æ–≤–∏—Ç—å</button>
      <ul>
        {users.map(user => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
    </div>
  );
};
```

### –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IndexedDB
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞  
- ‚úÖ Reactive –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/dataSync/
‚îú‚îÄ‚îÄ core/                              # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ apiClient.ts                   # üåê HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
‚îÇ   ‚îú‚îÄ‚îÄ dbClient.ts                    # üíæ –ö–ª–∏–µ–Ω—Ç IndexedDB + –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤–µ—Ä—Å–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ syncManager.ts                 # üîÑ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ utils/                             # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ç–∏–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ syncUtils.ts                   # üõ†Ô∏è –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ syncTypes.ts                   # üìù TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îî‚îÄ‚îÄ index.ts                           # üì¶ –ì–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç API

src/hooks/
‚îú‚îÄ‚îÄ useSyncData.ts                     # ‚öõÔ∏è –û—Å–Ω–æ–≤–Ω–æ–π —Ö—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ useIndexedDBData.ts                # üìä –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ö—É–∫ –¥–ª—è –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
```

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. üèóÔ∏è Core Layer

#### `DatabaseVersionManager` (Singleton)
–ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤–µ—Ä—Å–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:

```typescript
class DatabaseVersionManager {
  static getInstance(): DatabaseVersionManager
  async ensureDatabase(requiredTables: string[]): Promise<IDBDatabase>
  close(): void
  reset(): void
}
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üîí **Singleton –ø–∞—Ç—Ç–µ—Ä–Ω** - –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üîÑ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - –∏–∑–±–µ–≥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π
- üõ°Ô∏è **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π** - —Å–æ–∑–¥–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã

#### `DbClient`
–û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ IndexedDB –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:

```typescript
class DbClient {
  async init(tables: string[]): Promise<void>
  async getTable(tableName: string): Promise<any[]>
  async putAll(tableName: string, records: any[]): Promise<void>
  async deleteRecord(tableName: string, key: number): Promise<void>
}
```

#### `ApiClient`
HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:

```typescript
class ApiClient {
  async getTableData(tableName: string, lastSync: string): Promise<any[]>
  async getTableVersion(tableName: string): Promise<string>
}
```

#### `SyncManager`
–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```typescript
class SyncManager {
  async init(): Promise<void>
  async sync(): Promise<void>
  async getTableData(tableName: string): Promise<any[]>
}
```

### 2. üõ†Ô∏è Utils Layer

#### `SyncUtils`
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:

```typescript
class SyncUtils {
  async initialize(): Promise<boolean>
  async sync(): Promise<SyncResult>
  async resetDatabase(): Promise<void>
  setEventCallback(callback: SyncEventCallback): void
  async getTableData(tableName: string): Promise<any[]>
}
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üì° **Event callbacks** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- üîÑ **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚ö° **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- üîç **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** - –ø–æ–ª–Ω–∞—è/–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### 3. ‚öõÔ∏è Hooks Layer

#### `useSyncData` - –û—Å–Ω–æ–≤–Ω–æ–π —Ö—É–∫
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π:

```typescript
const {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  isInitialized,
  isLoading,
  error,
  
  // –î–∞–Ω–Ω—ã–µ
  tableData,
  syncStatuses,
  lastSyncResult,
  
  // –ú–µ—Ç–æ–¥—ã
  sync,
  loadTableData,
  resetDatabase,
  
  // –£—Ç–∏–ª–∏—Ç—ã
  getSyncMetrics,
  isDataFresh,
  needsSync
} = useSyncData(config, options);
```

#### `useIndexedDBData` - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ö—É–∫
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π:

```typescript
const {
  data,
  isLoading,
  error,
  refresh,
  sync
} = useIndexedDBData('tableName', config);
```

## üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

#### `SyncConfig`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
```typescript
interface SyncConfig {
  tables: string[];              // –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  apiBaseUrl?: string;           // URL API —Å–µ—Ä–≤–µ—Ä–∞
  displayName?: string;          // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –∏–º—è
  description?: string;          // –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
}
```

#### `SyncStatus`
–°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:
```typescript
interface SyncStatus {
  table: string;                 // –ò–º—è —Ç–∞–±–ª–∏—Ü—ã
  status: 'idle' | 'checking' | 'syncing' | 'success' | 'error';
  message: string;               // –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  localVersion?: string;         // –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
  serverVersion?: string;        // –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è
}
```

#### `SyncResult`
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
```typescript
interface SyncResult {
  success: boolean;              // –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
  results: TableSyncResult[];    // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
  totalTime: number;             // –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º—Å)
  timestamp: string;             // –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (ISO)
}
```

#### `TableSyncResult`
–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã:
```typescript
interface TableSyncResult {
  table: string;                 // –ò–º—è —Ç–∞–±–ª–∏—Ü—ã
  success: boolean;              // –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
  recordsInserted: number;       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
  recordsUpdated: number;        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
  recordsDeleted: number;        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
  error?: string;                // –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
}
```

### –û–ø—Ü–∏–∏ —Ö—É–∫–∞ `useSyncData`

```typescript
interface UseSyncDataOptions {
  autoInitialize?: boolean;      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (default: true)
  autoSync?: boolean;            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (default: false)
  syncInterval?: number;         // –ò–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö
  maxRetries?: number;           // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (default: 3)
  retryDelay?: number;           // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ –≤ –º—Å (default: 1000)
}
```

### –ú–µ—Ç–æ–¥—ã —Ö—É–∫–∞ `useSyncData`

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
```typescript
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
const result = await sync();

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ IndexedDB
const users = await loadTableData('users');

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
const allData = await loadAllData();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
const users = getTableDataFromState('users');
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π
```typescript
// –†—É—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ autoInitialize: false)
const success = await initialize();

// –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
await resetDatabase();

// –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫
clearError();
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–≤ –º–∏–Ω—É—Ç–∞—Ö)
const isFresh = isDataFresh('users', 30);

// –ù—É–∂–Ω–∞ –ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
const needsUpdate = needsSync(60);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
const metrics = getSyncMetrics();

// –°—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
const status = getSyncStatus('users');
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π

```typescript
// components/ProductList.tsx
import React from 'react';
import { useSyncData } from '../hooks/useSyncData';
import { productSyncConfig } from '../config/syncConfig';

const ProductList: React.FC = () => {
  const {
    tableData,
    isLoading,
    error,
    sync,
    isDataFresh,
    lastSyncResult
  } = useSyncData(productSyncConfig, {
    autoInitialize: true,
    autoSync: true,
    syncInterval: 15 // –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
  });

  const products = tableData?.products || [];

  return (
    <div className="product-list">
      <div className="header">
        <h2>–¢–æ–≤–∞—Ä—ã ({products.length})</h2>
        <button 
          onClick={sync} 
          disabled={isLoading}
          className={!isDataFresh('products', 30) ? 'btn-warning' : 'btn-primary'}
        >
          {isLoading ? '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...' : '–û–±–Ω–æ–≤–∏—Ç—å'}
        </button>
      </div>

      {error && (
        <div className="alert alert-error">
          –û—à–∏–±–∫–∞: {error}
        </div>
      )}

      {lastSyncResult && (
        <div className="sync-info">
          –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: {new Date(lastSyncResult.timestamp).toLocaleString()}
          {!lastSyncResult.success && <span className="error"> (—Å –æ—à–∏–±–∫–∞–º–∏)</span>}
        </div>
      )}

      <div className="product-grid">
        {products.map(product => (
          <div key={product.id} className="product-card">
            <h3>{product.name}</h3>
            <p>{product.description}</p>
            <div className="price">{product.price} ‚ÇΩ</div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

### 2. –ú–∞—Å—Ç–µ—Ä-–¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

```typescript
// components/OrderMasterDetail.tsx
import React, { useState } from 'react';
import { useSyncData } from '../hooks/useSyncData';
import { orderSyncConfig } from '../config/syncConfig';

const OrderMasterDetail: React.FC = () => {
  const [selectedOrderId, setSelectedOrderId] = useState<number | null>(null);
  
  const {
    tableData,
    loadTableData,
    isLoading
  } = useSyncData(orderSyncConfig);

  const orders = tableData?.orders || [];
  const orderItems = tableData?.order_items || [];
  const customers = tableData?.customers || [];

  const selectedOrder = orders.find(o => o.id === selectedOrderId);
  const selectedOrderItems = orderItems.filter(item => item.order_id === selectedOrderId);
  const customer = customers.find(c => c.id === selectedOrder?.customer_id);

  const handleOrderClick = async (orderId: number) => {
    setSelectedOrderId(orderId);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    if (orderItems.length === 0) {
      await loadTableData('order_items');
    }
  };

  return (
    <div className="order-master-detail">
      <div className="master-panel">
        <h2>–ó–∞–∫–∞–∑—ã</h2>
        {isLoading && <div className="spinner">–ó–∞–≥—Ä—É–∑–∫–∞...</div>}
        
        <div className="order-list">
          {orders.map(order => (
            <div 
              key={order.id}
              className={`order-item ${selectedOrderId === order.id ? 'selected' : ''}`}
              onClick={() => handleOrderClick(order.id)}
            >
              <div className="order-number">#{order.number}</div>
              <div className="order-date">{new Date(order.created_at).toLocaleDateString()}</div>
              <div className="order-amount">{order.total_amount} ‚ÇΩ</div>
            </div>
          ))}
        </div>
      </div>

      <div className="detail-panel">
        {selectedOrder ? (
          <div className="order-details">
            <h3>–ó–∞–∫–∞–∑ #{selectedOrder.number}</h3>
            
            <div className="customer-info">
              <h4>–ö–ª–∏–µ–Ω—Ç</h4>
              <p>{customer?.name || '–ù–µ –Ω–∞–π–¥–µ–Ω'}</p>
            </div>

            <div className="order-items">
              <h4>–¢–æ–≤–∞—Ä—ã</h4>
              {selectedOrderItems.map(item => (
                <div key={item.id} className="order-item-row">
                  <span>{item.product_name}</span>
                  <span>{item.quantity} —à—Ç.</span>
                  <span>{item.price} ‚ÇΩ</span>
                </div>
              ))}
            </div>

            <div className="order-total">
              <strong>–ò—Ç–æ–≥–æ: {selectedOrder.total_amount} ‚ÇΩ</strong>
            </div>
          </div>
        ) : (
          <div className="no-selection">
            –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
          </div>
        )}
      </div>
    </div>
  );
};
```

### 3. Offline-ready –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```typescript
// components/OfflineApp.tsx
import React, { useEffect, useState } from 'react';
import { useSyncData } from '../hooks/useSyncData';
import { appSyncConfig } from '../config/syncConfig';

const OfflineApp: React.FC = () => {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingChanges, setPendingChanges] = useState([]);

  const {
    tableData,
    sync,
    isLoading,
    error,
    lastSyncResult,
    needsSync
  } = useSyncData(appSyncConfig);

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ç–∏
  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
  useEffect(() => {
    if (isOnline && needsSync(5)) {
      console.log('üåê –°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...');
      sync();
    }
  }, [isOnline, sync, needsSync]);

  const handleCreateRecord = async (data: any) => {
    if (isOnline) {
      // –°–æ–∑–¥–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º
      await createOnServer(data);
      await sync();
    } else {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
      const pendingChange = {
        id: Date.now(),
        operation: 'create',
        table: 'records',
        data,
        timestamp: new Date().toISOString()
      };
      
      setPendingChanges(prev => [...prev, pendingChange]);
      console.log('üì± –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
    }
  };

  const syncPendingChanges = async () => {
    if (!isOnline || pendingChanges.length === 0) return;

    for (const change of pendingChanges) {
      try {
        await applyChangeOnServer(change);
        setPendingChanges(prev => prev.filter(c => c.id !== change.id));
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:', error);
      }
    }

    await sync();
  };

  return (
    <div className="offline-app">
      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ç–∏ */}
      <div className={`network-status ${isOnline ? 'online' : 'offline'}`}>
        <span className="status-icon">
          {isOnline ? 'üåê' : 'üì±'}
        </span>
        <span className="status-text">
          {isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º'}
        </span>
        
        {pendingChanges.length > 0 && (
          <span className="pending-changes">
            {pendingChanges.length} –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–∂–∏–¥–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
          </span>
        )}
      </div>

      {/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}
      <div className="controls">
        <button onClick={sync} disabled={!isOnline || isLoading}>
          {isLoading ? '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...' : '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å'}
        </button>
        
        {pendingChanges.length > 0 && isOnline && (
          <button onClick={syncPendingChanges} className="btn-warning">
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ({pendingChanges.length})
          </button>
        )}
      </div>

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */}
      {lastSyncResult && (
        <div className="sync-info">
          <small>
            –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: {new Date(lastSyncResult.timestamp).toLocaleString()}
            {lastSyncResult.success ? ' ‚úÖ' : ' ‚ùå'}
          </small>
        </div>
      )}

      {error && (
        <div className="alert alert-error">
          {error}
        </div>
      )}

      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */}
      <div className="app-content">
        {/* –í–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –∑–¥–µ—Å—å */}
      </div>
    </div>
  );
};
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```typescript
// components/SyncMonitor.tsx
import React from 'react';
import { useSyncData } from '../hooks/useSyncData';
import { monitorConfig } from '../config/syncConfig';

const SyncMonitor: React.FC = () => {
  const {
    syncStatuses,
    lastSyncResult,
    getSyncMetrics,
    isLoading,
    resetDatabase
  } = useSyncData(monitorConfig);

  const metrics = getSyncMetrics();

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'success': return '‚úÖ';
      case 'error': return '‚ùå';
      case 'syncing': return 'üîÑ';
      case 'checking': return 'üîç';
      default: return '‚è∏Ô∏è';
    }
  };

  const getStatusClass = (status: string) => {
    switch (status) {
      case 'success': return 'status-success';
      case 'error': return 'status-error';
      case 'syncing': return 'status-syncing';
      case 'checking': return 'status-checking';
      default: return 'status-idle';
    }
  };

  return (
    <div className="sync-monitor">
      <div className="monitor-header">
        <h3>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
        <button 
          onClick={resetDatabase}
          className="btn-danger btn-sm"
          title="–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã"
        >
          –°–±—Ä–æ—Å–∏—Ç—å –ë–î
        </button>
      </div>

      {/* –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ */}
      <div className="sync-metrics">
        <div className="metric">
          <span className="metric-label">–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü:</span>
          <span className="metric-value">{metrics.totalTables}</span>
        </div>
        <div className="metric">
          <span className="metric-label">–£—Å–ø–µ—à–Ω–æ:</span>
          <span className="metric-value text-success">{metrics.successfulTables}</span>
        </div>
        <div className="metric">
          <span className="metric-label">–° –æ—à–∏–±–∫–∞–º–∏:</span>
          <span className="metric-value text-error">{metrics.failedTables}</span>
        </div>
        <div className="metric">
          <span className="metric-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π:</span>
          <span className="metric-value">{metrics.totalRecordsProcessed}</span>
        </div>
      </div>

      {/* –°—Ç–∞—Ç—É—Å—ã —Ç–∞–±–ª–∏—Ü */}
      <div className="table-statuses">
        <h4>–°—Ç–∞—Ç—É—Å —Ç–∞–±–ª–∏—Ü</h4>
        {syncStatuses.map(status => (
          <div key={status.table} className={`table-status ${getStatusClass(status.status)}`}>
            <div className="status-header">
              <span className="status-icon">{getStatusIcon(status.status)}</span>
              <span className="table-name">{status.table}</span>
              <span className="status-badge">{status.status}</span>
            </div>
            
            <div className="status-message">
              {status.message}
            </div>
            
            {status.localVersion && status.serverVersion && (
              <div className="version-info">
                <small>
                  –õ–æ–∫–∞–ª—å–Ω–∞—è: {status.localVersion} | 
                  –°–µ—Ä–≤–µ—Ä–Ω–∞—è: {status.serverVersion}
                </small>
              </div>
            )}
          </div>
        ))}
      </div>

      {/* –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */}
      {lastSyncResult && (
        <div className="last-sync-result">
          <h4>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h4>
          <div className={`sync-summary ${lastSyncResult.success ? 'success' : 'error'}`}>
            <div className="summary-header">
              <span>{lastSyncResult.success ? '‚úÖ' : '‚ùå'} –°—Ç–∞—Ç—É—Å: {lastSyncResult.success ? '–£—Å–ø–µ—à–Ω–æ' : '–° –æ—à–∏–±–∫–∞–º–∏'}</span>
              <span>‚è±Ô∏è –í—Ä–µ–º—è: {lastSyncResult.totalTime}–º—Å</span>
              <span>üïê {new Date(lastSyncResult.timestamp).toLocaleString()}</span>
            </div>
            
            <div className="sync-details">
              {lastSyncResult.results.map(result => (
                <div key={result.table} className="table-result">
                  <strong>{result.table}:</strong>
                  {result.success ? (
                    <span className="text-success">
                      +{result.recordsInserted} ~{result.recordsUpdated} -{result.recordsDeleted}
                    </span>
                  ) : (
                    <span className="text-error">{result.error}</span>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {isLoading && (
        <div className="loading-overlay">
          <div className="spinner"></div>
          <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</span>
        </div>
      )}
    </div>
  );
};
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```typescript
// config/syncConfig.ts
import { SyncConfig } from '../dataSync';

// –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
export const basicSyncConfig: SyncConfig = {
  tables: ['users', 'orders'],
  apiBaseUrl: 'https://api.example.com'
};

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
export const advancedSyncConfig: SyncConfig = {
  tables: [
    'reference_products',
    'reference_categories', 
    'reference_suppliers',
    'link_product_categories',
    'transactions'
  ],
  apiBaseUrl: process.env.REACT_APP_API_URL || 'http://localhost:3000',
  displayName: '–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏',
  description: '–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏'
};

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
export const createSyncConfig = (environment: 'development' | 'production'): SyncConfig => ({
  tables: ['users', 'settings', 'data'],
  apiBaseUrl: environment === 'production' 
    ? 'https://api.mycompany.com'
    : 'http://localhost:3000',
  displayName: `–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (${environment})`,
  description: `–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è ${environment} –æ–∫—Ä—É–∂–µ–Ω–∏—è`
});
```

### –§–∞–±—Ä–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```typescript
// utils/configFactory.ts
import { SyncConfig } from '../dataSync';

export const createModuleSyncConfig = (
  moduleName: string,
  tables: string[],
  baseUrl?: string
): SyncConfig => ({
  tables,
  apiBaseUrl: baseUrl || process.env.REACT_APP_API_URL || 'http://localhost:3000',
  displayName: `–ú–æ–¥—É–ª—å: ${moduleName}`,
  description: `–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è ${moduleName}`
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
export const userModuleConfig = createModuleSyncConfig(
  '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
  ['users', 'user_roles', 'permissions']
);

export const inventoryModuleConfig = createModuleSyncConfig(
  '–°–∫–ª–∞–¥',
  ['products', 'categories', 'stock_movements']
);
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø—Ü–∏–∏

```typescript
// hooks/useAdvancedSync.ts
import { useSyncData } from './useSyncData';
import { SyncConfig } from '../dataSync';

interface AdvancedSyncOptions {
  enableOfflineMode?: boolean;
  syncOnFocus?: boolean;
  syncOnNetworkRestore?: boolean;
  maxCacheAge?: number; // –º–∏–Ω—É—Ç—ã
}

export const useAdvancedSync = (
  config: SyncConfig, 
  options: AdvancedSyncOptions = {}
) => {
  const {
    enableOfflineMode = true,
    syncOnFocus = true,
    syncOnNetworkRestore = true,
    maxCacheAge = 60
  } = options;

  const syncData = useSyncData(config, {
    autoInitialize: true,
    autoSync: false
  });

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –æ–∫–Ω–∞
  useEffect(() => {
    if (!syncOnFocus) return;

    const handleFocus = () => {
      if (syncData.needsSync(maxCacheAge)) {
        console.log('üîÑ –û–∫–Ω–æ –ø–æ–ª—É—á–∏–ª–æ —Ñ–æ–∫—É—Å, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ...');
        syncData.sync();
      }
    };

    window.addEventListener('focus', handleFocus);
    return () => window.removeEventListener('focus', handleFocus);
  }, [syncOnFocus, maxCacheAge, syncData]);

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
  useEffect(() => {
    if (!syncOnNetworkRestore) return;

    const handleOnline = () => {
      console.log('üåê –°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...');
      syncData.sync();
    };

    window.addEventListener('online', handleOnline);
    return () => window.removeEventListener('online', handleOnline);
  }, [syncOnNetworkRestore, syncData]);

  return {
    ...syncData,
    isOfflineMode: enableOfflineMode && !navigator.onLine
  };
};
```

## üîß Troubleshooting

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. "Database not initialized" 
```
‚ùå –û—à–∏–±–∫–∞: Database not initialized. Please call init() first.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –º–µ—Ç–æ–¥–∞–º –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const { isInitialized, loadTableData } = useSyncData(config);

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
useEffect(() => {
  loadTableData('users'); // –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å—Å—è –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
}, []);

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
useEffect(() => {
  if (isInitialized) {
    loadTableData('users');
  }
}, [isInitialized]);
```

#### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π IndexedDB
```
‚ö†Ô∏è DatabaseVersionManager: –û—Ç–∫—Ä—ã—Ç–∏–µ –ë–î –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
// –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ç–∏–ª–∏—Ç—É —Å–±—Ä–æ—Å–∞:

import { clearDatabase } from '../dataSync';

const resetDb = async () => {
  await clearDatabase();
  window.location.reload();
};
```

#### 3. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```
‚ùå –î–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
üìä banksData –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: 0 []
```

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –≤ `tables` –º–∞—Å—Å–∏–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚ùå –ù–µ–ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const config: SyncConfig = {
  tables: ['users', 'orders'] // –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç 'banks'
};

// ‚úÖ –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const config: SyncConfig = {
  tables: ['users', 'orders', 'banks'] // –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
};
```

#### 4. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```
üîÑ useSyncData: –í—ã–∑—ã–≤–∞–µ–º syncUtils.initialize()...
üîÑ useSyncData: –í—ã–∑—ã–≤–∞–µ–º syncUtils.initialize()...
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `useEffect` –≤–∫–ª—é—á–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - loadData –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
useEffect(() => {
  if (isInitialized) {
    loadData();
  }
}, [isInitialized, loadData]); // loadData –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–ª–∞–≥
const [dataLoaded, setDataLoaded] = useState(false);

useEffect(() => {
  if (isInitialized && !dataLoaded) {
    loadData().then(() => setDataLoaded(true));
  }
}, [isInitialized, dataLoaded]);
```

#### 5. –î–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```
‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
üìä tableData –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø—É—Å—Ç–æ–π
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const { tableData, lastSyncResult } = useSyncData(config);

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
useEffect(() => {
  if (lastSyncResult?.success) {
    // –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    // –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é useSyncData
  }
}, [lastSyncResult]);
```

### –û—Ç–ª–∞–¥–∫–∞

#### –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```typescript
// –í localStorage
localStorage.setItem('sync_debug', 'true');

// –ò–ª–∏ –≤ –∫–æ–¥–µ
console.log('üîç Debug —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```typescript
const { getSyncMetrics } = useSyncData(config);

useEffect(() => {
  const metrics = getSyncMetrics();
  console.log('üìä –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', {
    totalTables: metrics.totalTables,
    syncDuration: metrics.syncDuration,
    totalRecords: metrics.totalRecordsProcessed,
    lastSync: metrics.lastSyncTime
  });
}, [getSyncMetrics]);
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è IndexedDB
```typescript
// –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î
const inspectDatabase = async () => {
  const { loadTableData } = useSyncData(config);
  
  const tables = ['users', 'orders', 'products'];
  for (const table of tables) {
    try {
      const data = await loadTableData(table);
      console.log(`üìä ${table}:`, data.length, '–∑–∞–ø–∏—Å–µ–π');
      console.log('üìù –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å:', data[0]);
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${table}:`, error);
    }
  }
};
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```typescript
// –í SyncUtils - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
const BATCH_SIZE = 1000;

const processBatches = async (records: any[], tableName: string) => {
  for (let i = 0; i < records.length; i += BATCH_SIZE) {
    const batch = records.slice(i, i + BATCH_SIZE);
    await this.syncManager.db.putAll(tableName, batch);
    
    // –î–∞–µ–º –±—Ä–∞—É–∑–µ—Ä—É –ø–µ—Ä–µ–¥–æ—Ö–Ω—É—Ç—å
    await new Promise(resolve => setTimeout(resolve, 0));
    
    console.log(`üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${i + batch.length}/${records.length} –∑–∞–ø–∏—Å–µ–π`);
  }
};
```

#### Lazy Loading —Ç–∞–±–ª–∏—Ü
```typescript
const useLazyTableData = (tableName: string, config: SyncConfig) => {
  const [data, setData] = useState<any[]>([]);
  const [loaded, setLoaded] = useState(false);
  
  const { loadTableData, isInitialized } = useSyncData(config);

  const loadData = useCallback(async () => {
    if (!loaded && isInitialized) {
      console.log(`üì• Lazy loading: ${tableName}`);
      const tableData = await loadTableData(tableName);
      setData(tableData);
      setLoaded(true);
    }
  }, [loaded, isInitialized, tableName, loadTableData]);

  return { data, loadData, loaded };
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const OrderDetails: React.FC<{ orderId: number }> = ({ orderId }) => {
  const { data: orderItems, loadData } = useLazyTableData('order_items', config);
  
  useEffect(() => {
    if (orderId) {
      loadData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    }
  }, [orderId, loadData]);

  const items = orderItems.filter(item => item.order_id === orderId);
  return <div>{/* –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */}</div>;
};
```

#### –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```typescript
// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ DbClient –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
export class EnhancedDbClient extends DbClient {
  async createIndexes(tableName: string, indexes: string[]): Promise<void> {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    const transaction = this.db!.transaction([tableName], 'readwrite');
    const store = transaction.objectStore(tableName);
    
    indexes.forEach(indexName => {
      if (!store.indexNames.contains(indexName)) {
        store.createIndex(indexName, indexName, { unique: false });
      }
    });
  }

  async findByIndex(tableName: string, indexName: string, value: any): Promise<any[]> {
    return new Promise((resolve, reject) => {
      const transaction = this.db!.transaction([tableName], 'readonly');
      const store = transaction.objectStore(tableName);
      const index = store.index(indexName);
      const request = index.getAll(value);
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
}
```

#### –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
```typescript
import { useMemo } from 'react';

const ProductList: React.FC = () => {
  const { tableData } = useSyncData(config);
  
  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
  const processedProducts = useMemo(() => {
    const products = tableData?.products || [];
    const categories = tableData?.categories || [];
    
    return products.map(product => ({
      ...product,
      category: categories.find(c => c.id === product.category_id),
      priceFormatted: new Intl.NumberFormat('ru-RU', {
        style: 'currency',
        currency: 'RUB'
      }).format(product.price)
    }));
  }, [tableData?.products, tableData?.categories]);

  return (
    <div>
      {processedProducts.map(product => (
        <ProductCard key={product.id} product={product} />
      ))}
    </div>
  );
};
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
// utils/performanceMonitor.ts
export class PerformanceMonitor {
  private static metrics = new Map<string, number>();

  static startTiming(label: string): void {
    this.metrics.set(label, performance.now());
  }

  static endTiming(label: string): number {
    const start = this.metrics.get(label);
    if (!start) return 0;
    
    const duration = performance.now() - start;
    this.metrics.delete(label);
    
    console.log(`‚è±Ô∏è ${label}: ${duration.toFixed(2)}ms`);
    return duration;
  }

  static async measureAsync<T>(label: string, fn: () => Promise<T>): Promise<T> {
    this.startTiming(label);
    try {
      const result = await fn();
      this.endTiming(label);
      return result;
    } catch (error) {
      this.endTiming(label);
      throw error;
    }
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const { sync } = useSyncData(config);

const handleSync = async () => {
  await PerformanceMonitor.measureAsync('Full Sync', async () => {
    await sync();
  });
};
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

```typescript
// __tests__/syncUtils.test.ts
import { SyncUtils } from '../dataSync/utils/syncUtils';
import { MockApiClient } from './mocks/MockApiClient';

describe('SyncUtils', () => {
  let syncUtils: SyncUtils;
  let mockApi: MockApiClient;

  beforeEach(() => {
    mockApi = new MockApiClient();
    syncUtils = new SyncUtils(['users'], 'http://localhost:3000');
  });

  it('–¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è', async () => {
    const result = await syncUtils.initialize();
    expect(result).toBe(true);
  });

  it('–¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ', async () => {
    mockApi.setTableData('users', [
      { id: 1, name: 'John', email: 'john@test.com' }
    ]);

    await syncUtils.initialize();
    const result = await syncUtils.sync();

    expect(result.success).toBe(true);
    expect(result.results).toHaveLength(1);
    expect(result.results[0].recordsInserted).toBe(1);
  });

  it('–¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏', async () => {
    mockApi.simulateNetworkError();

    await syncUtils.initialize();
    const result = await syncUtils.sync();

    expect(result.success).toBe(false);
    expect(result.results[0].error).toContain('Network error');
  });
});
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Ö—É–∫–æ–≤

```typescript
// __tests__/useSyncData.test.tsx
import { renderHook, act } from '@testing-library/react-hooks';
import { useSyncData } from '../hooks/useSyncData';
import { createTestSyncConfig } from './helpers/testConfig';

describe('useSyncData', () => {
  it('–¥–æ–ª–∂–µ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ', async () => {
    const config = createTestSyncConfig();
    const { result, waitForNextUpdate } = renderHook(() => 
      useSyncData(config, { autoInitialize: true })
    );

    expect(result.current.isInitialized).toBe(false);
    expect(result.current.isLoading).toBe(true);

    await waitForNextUpdate();

    expect(result.current.isInitialized).toBe(true);
    expect(result.current.isLoading).toBe(false);
  });

  it('–¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É', async () => {
    const config = createTestSyncConfig();
    const { result } = renderHook(() => useSyncData(config));

    await act(async () => {
      await result.current.sync();
    });

    expect(result.current.lastSyncResult).toBeTruthy();
    expect(result.current.lastSyncResult?.success).toBe(true);
  });
});
```

### –ú–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// __tests__/mocks/MockApiClient.ts
export class MockApiClient {
  private tableData = new Map<string, any[]>();
  private shouldError = false;

  setTableData(tableName: string, data: any[]): void {
    this.tableData.set(tableName, data);
  }

  simulateNetworkError(): void {
    this.shouldError = true;
  }

  async getTableData(tableName: string): Promise<any[]> {
    if (this.shouldError) {
      throw new Error('Network error');
    }
    
    return this.tableData.get(tableName) || [];
  }

  async getTableVersion(tableName: string): Promise<string> {
    if (this.shouldError) {
      throw new Error('Network error');
    }
    
    return 'v1.0';
  }
}
```

### E2E —Ç–µ—Å—Ç—ã

```typescript
// __tests__/e2e/sync.e2e.test.ts
import { chromium, Browser, Page } from 'playwright';

describe('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è E2E', () => {
  let browser: Browser;
  let page: Page;

  beforeAll(async () => {
    browser = await chromium.launch();
    page = await browser.newPage();
  });

  afterAll(async () => {
    await browser.close();
  });

  it('–¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', async () => {
    await page.goto('http://localhost:3000/sync-test');
    
    // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    await page.waitForSelector('[data-testid="sync-status"]');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const status = await page.textContent('[data-testid="sync-status"]');
    expect(status).toContain('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è');
    
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    await page.waitForSelector('[data-testid="sync-success"]');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    const successMessage = await page.textContent('[data-testid="sync-success"]');
    expect(successMessage).toContain('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  });

  it('–¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏', async () => {
    await page.click('[data-testid="sync-button"]');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    await page.waitForSelector('[data-testid="sync-loading"]');
    
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    await page.waitForSelector('[data-testid="sync-success"]');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const dataCount = await page.textContent('[data-testid="data-count"]');
    expect(parseInt(dataCount || '0')).toBeGreaterThan(0);
  });
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```typescript
// utils/dataValidator.ts
export class DataValidator {
  static validateRecord(record: any, schema: any): ValidationResult {
    const errors: string[] = [];
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    Object.keys(schema).forEach(field => {
      if (schema[field].required && !record[field]) {
        errors.push(`–ü–æ–ª–µ ${field} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ`);
      }
    });
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
    Object.keys(record).forEach(field => {
      if (schema[field]?.type && typeof record[field] !== schema[field].type) {
        errors.push(`–ü–æ–ª–µ ${field} –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∏–ø–∞ ${schema[field].type}`);
      }
    });
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }

  static sanitizeRecord(record: any): any {
    // –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –ø–æ–ª—è
    const sanitized = { ...record };
    delete sanitized.__proto__;
    delete sanitized.constructor;
    
    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏
    Object.keys(sanitized).forEach(key => {
      if (typeof sanitized[key] === 'string') {
        sanitized[key] = sanitized[key]
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#x27;');
      }
    });
    
    return sanitized;
  }
}
```

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```typescript
// utils/encryption.ts
export class EncryptionService {
  private static readonly ALGORITHM = 'AES-GCM';
  private static readonly KEY_LENGTH = 256;

  static async generateKey(): Promise<CryptoKey> {
    return await window.crypto.subtle.generateKey(
      {
        name: this.ALGORITHM,
        length: this.KEY_LENGTH,
      },
      true,
      ['encrypt', 'decrypt']
    );
  }

  static async encryptData(data: string, key: CryptoKey): Promise<string> {
    const encoder = new TextEncoder();
    const dataBuffer = encoder.encode(data);
    
    const iv = window.crypto.getRandomValues(new Uint8Array(12));
    
    const encrypted = await window.crypto.subtle.encrypt(
      {
        name: this.ALGORITHM,
        iv: iv
      },
      key,
      dataBuffer
    );
    
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º IV –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const combined = new Uint8Array(iv.length + encrypted.byteLength);
    combined.set(iv);
    combined.set(new Uint8Array(encrypted), iv.length);
    
    return btoa(String.fromCharCode.apply(null, Array.from(combined)));
  }

  static async decryptData(encryptedData: string, key: CryptoKey): Promise<string> {
    const combined = new Uint8Array(
      atob(encryptedData).split('').map(char => char.charCodeAt(0))
    );
    
    const iv = combined.slice(0, 12);
    const encrypted = combined.slice(12);
    
    const decrypted = await window.crypto.subtle.decrypt(
      {
        name: this.ALGORITHM,
        iv: iv
      },
      key,
      encrypted
    );
    
    const decoder = new TextDecoder();
    return decoder.decode(decrypted);
  }
}
```

## üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```typescript
// hooks/useAdaptiveSync.ts
import { useState, useEffect } from 'react';
import { useSyncData } from './useSyncData';

interface AdaptiveSyncOptions {
  wifiSyncInterval?: number;    // –º–∏–Ω—É—Ç—ã –Ω–∞ WiFi
  mobileSyncInterval?: number;  // –º–∏–Ω—É—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π —Å–µ—Ç–∏
  lowBatteryThreshold?: number; // –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞—Ä—è–¥–∞
}

export const useAdaptiveSync = (
  config: SyncConfig,
  options: AdaptiveSyncOptions = {}
) => {
  const {
    wifiSyncInterval = 5,
    mobileSyncInterval = 30,
    lowBatteryThreshold = 20
  } = options;

  const [networkInfo, setNetworkInfo] = useState({
    type: 'wifi',
    effectiveType: '4g'
  });
  
  const [batteryLevel, setBatteryLevel] = useState(100);

  const syncData = useSyncData(config, { autoSync: false });

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ç–∏
  useEffect(() => {
    if ('connection' in navigator) {
      const connection = (navigator as any).connection;
      
      const updateNetworkInfo = () => {
        setNetworkInfo({
          type: connection.type || 'wifi',
          effectiveType: connection.effectiveType || '4g'
        });
      };

      connection.addEventListener('change', updateNetworkInfo);
      updateNetworkInfo();

      return () => {
        connection.removeEventListener('change', updateNetworkInfo);
      };
    }
  }, []);

  // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞—Ç–∞—Ä–µ–∏
  useEffect(() => {
    if ('getBattery' in navigator) {
      (navigator as any).getBattery().then((battery: any) => {
        const updateBatteryLevel = () => {
          setBatteryLevel(battery.level * 100);
        };

        battery.addEventListener('levelchange', updateBatteryLevel);
        updateBatteryLevel();

        return () => {
          battery.removeEventListener('levelchange', updateBatteryLevel);
        };
      });
    }
  }, []);

  // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
  useEffect(() => {
    // –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∑–∞—Ä—è–¥–µ
    if (batteryLevel < lowBatteryThreshold) {
      console.log(`üîã –ù–∏–∑–∫–∏–π –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–∏ (${batteryLevel}%), —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–ª–æ–∂–µ–Ω–∞`);
      return;
    }

    // –í—ã–±–∏—Ä–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–µ—Ç–∏
    const interval = networkInfo.type === 'wifi' 
      ? wifiSyncInterval 
      : mobileSyncInterval;

    const timer = setInterval(() => {
      if (syncData.needsSync(interval)) {
        console.log(`üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (${networkInfo.type})`);
        syncData.sync();
      }
    }, interval * 60 * 1000);

    return () => clearInterval(timer);
  }, [networkInfo, batteryLevel, lowBatteryThreshold, wifiSyncInterval, mobileSyncInterval, syncData]);

  return {
    ...syncData,
    networkInfo,
    batteryLevel,
    isOptimalConditions: networkInfo.type === 'wifi' && batteryLevel > lowBatteryThreshold
  };
};
```

## üöÄ Deployment

### Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
// config/production.ts
export const productionSyncConfig: SyncConfig = {
  tables: [
    'reference_products',
    'reference_categories',
    'transactions',
    'user_settings'
  ],
  apiBaseUrl: process.env.REACT_APP_API_URL!,
  displayName: '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
  description: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö'
};

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production
export const productionOptions = {
  autoInitialize: true,
  autoSync: true,
  syncInterval: 30, // 30 –º–∏–Ω—É—Ç
  maxRetries: 5,
  retryDelay: 2000
};
```

### Service Worker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
// public/sw.js - Service Worker –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
self.addEventListener('sync', event => {
  if (event.tag === 'background-sync') {
    event.waitUntil(performBackgroundSync());
  }
});

self.addEventListener('message', event => {
  if (event.data && event.data.type === 'SYNC_REQUEST') {
    // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
    self.registration.sync.register('background-sync');
  }
});

async function performBackgroundSync() {
  try {
    const response = await fetch('/api/sync?tables=all&since=' + getLastSyncTime());
    const data = await response.json();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ IndexedDB —á–µ—Ä–µ–∑ Service Worker
    await updateIndexedDBFromServiceWorker(data);
    
    // –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    self.clients.matchAll().then(clients => {
      clients.forEach(client => {
        client.postMessage({
          type: 'SYNC_COMPLETE',
          success: true,
          timestamp: new Date().toISOString()
        });
      });
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
  }
}
```

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

```dockerfile
# Dockerfile –¥–ª—è React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/build /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

```nginx
# nginx.conf
events {}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    server {
        listen 80;
        server_name localhost;
        
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
        }
        
        # API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è CORS
        location /api/ {
            proxy_pass http://api-server:3000/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
        
        # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}
```

### Environment-specific –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```typescript
// config/environments.ts
interface EnvironmentConfig {
  apiBaseUrl: string;
  syncInterval: number;
  retryAttempts: number;
  debugMode: boolean;
  enableOfflineMode: boolean;
}

const environments: Record<string, EnvironmentConfig> = {
  development: {
    apiBaseUrl: 'http://localhost:3000',
    syncInterval: 5, // —á–∞—Å—Ç–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    retryAttempts: 3,
    debugMode: true,
    enableOfflineMode: true
  },
  
  staging: {
    apiBaseUrl: 'https://api-staging.company.com',
    syncInterval: 15,
    retryAttempts: 5,
    debugMode: true,
    enableOfflineMode: true
  },
  
  production: {
    apiBaseUrl: 'https://api.company.com',
    syncInterval: 30,
    retryAttempts: 5,
    debugMode: false,
    enableOfflineMode: true
  }
};

export const getCurrentEnvironmentConfig = (): EnvironmentConfig => {
  const env = process.env.NODE_ENV || 'development';
  return environments[env] || environments.development;
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const envConfig = getCurrentEnvironmentConfig();

export const appSyncConfig: SyncConfig = {
  tables: ['users', 'settings', 'data'],
  apiBaseUrl: envConfig.apiBaseUrl,
  displayName: `–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (${process.env.NODE_ENV})`,
  description: '–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è'
};
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫

```typescript
// utils/metricsCollector.ts
export class MetricsCollector {
  private static metrics: Array<SyncMetric> = [];

  static recordSyncEvent(event: SyncMetric): void {
    this.metrics.push({
      ...event,
      timestamp: new Date().toISOString()
    });

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
    this.sendToAnalytics(event);
  }

  static getSyncMetrics(timeframe: 'hour' | 'day' | 'week' = 'day'): SyncAnalytics {
    const cutoff = this.getCutoffTime(timeframe);
    const recentMetrics = this.metrics.filter(m => 
      new Date(m.timestamp) > cutoff
    );

    return {
      totalSyncs: recentMetrics.length,
      successfulSyncs: recentMetrics.filter(m => m.success).length,
      failedSyncs: recentMetrics.filter(m => !m.success).length,
      averageDuration: this.calculateAverageDuration(recentMetrics),
      totalRecordsSynced: recentMetrics.reduce((sum, m) => sum + (m.recordCount || 0), 0),
      errorRate: this.calculateErrorRate(recentMetrics),
      mostActiveTable: this.getMostActiveTable(recentMetrics)
    };
  }

  private static sendToAnalytics(event: SyncMetric): void {
    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Analytics, Mixpanel –∏ —Ç.–¥.
    if (window.gtag) {
      window.gtag('event', 'sync_operation', {
        table_name: event.tableName,
        success: event.success,
        duration: event.duration,
        record_count: event.recordCount
      });
    }
  }

  private static getCutoffTime(timeframe: string): Date {
    const now = new Date();
    switch (timeframe) {
      case 'hour': return new Date(now.getTime() - 60 * 60 * 1000);
      case 'day': return new Date(now.getTime() - 24 * 60 * 60 * 1000);
      case 'week': return new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      default: return new Date(now.getTime() - 24 * 60 * 60 * 1000);
    }
  }
}

interface SyncMetric {
  tableName: string;
  success: boolean;
  duration: number;
  recordCount?: number;
  errorMessage?: string;
  timestamp: string;
}

interface SyncAnalytics {
  totalSyncs: number;
  successfulSyncs: number;
  failedSyncs: number;
  averageDuration: number;
  totalRecordsSynced: number;
  errorRate: number;
  mostActiveTable: string;
}
```

### Real-time –¥–∞—à–±–æ—Ä–¥

```typescript
// components/SyncDashboard.tsx
import React, { useEffect, useState } from 'react';
import { MetricsCollector } from '../utils/metricsCollector';

const SyncDashboard: React.FC = () => {
  const [metrics, setMetrics] = useState<SyncAnalytics | null>(null);
  const [timeframe, setTimeframe] = useState<'hour' | 'day' | 'week'>('day');

  useEffect(() => {
    const updateMetrics = () => {
      setMetrics(MetricsCollector.getSyncMetrics(timeframe));
    };

    updateMetrics();
    const interval = setInterval(updateMetrics, 30000); // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

    return () => clearInterval(interval);
  }, [timeframe]);

  if (!metrics) return <div>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç—Ä–∏–∫...</div>;

  const successRate = ((metrics.successfulSyncs / metrics.totalSyncs) * 100).toFixed(1);

  return (
    <div className="sync-dashboard">
      <div className="dashboard-header">
        <h2>üìä –î–∞—à–±–æ—Ä–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h2>
        <select 
          value={timeframe} 
          onChange={(e) => setTimeframe(e.target.value as any)}
          className="timeframe-selector"
        >
          <option value="hour">–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</option>
          <option value="day">–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å</option>
          <option value="week">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
        </select>
      </div>

      <div className="metrics-grid">
        <div className="metric-card">
          <div className="metric-value">{metrics.totalSyncs}</div>
          <div className="metric-label">–í—Å–µ–≥–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π</div>
        </div>

        <div className="metric-card success">
          <div className="metric-value">{successRate}%</div>
          <div className="metric-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
        </div>

        <div className="metric-card">
          <div className="metric-value">{metrics.averageDuration.toFixed(0)}–º—Å</div>
          <div className="metric-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
        </div>

        <div className="metric-card">
          <div className="metric-value">{metrics.totalRecordsSynced.toLocaleString()}</div>
          <div className="metric-label">–ó–∞–ø–∏—Å–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
        </div>

        <div className="metric-card">
          <div className="metric-value">{metrics.mostActiveTable}</div>
          <div className="metric-label">–°–∞–º–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
        </div>

        <div className="metric-card error">
          <div className="metric-value">{(metrics.errorRate * 100).toFixed(1)}%</div>
          <div className="metric-label">–ß–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫</div>
        </div>
      </div>

      <div className="sync-history">
        <h3>üïê –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
        {/* –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π */}
      </div>
    </div>
  );
};
```

## üîÆ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–ª–∞–≥–∏–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```typescript
// plugins/SyncPlugin.ts
export interface SyncPlugin {
  name: string;
  version: string;
  
  beforeSync?(tableName: string, data: any[]): Promise<any[]>;
  afterSync?(tableName: string, result: TableSyncResult): Promise<void>;
  onError?(tableName: string, error: Error): Promise<void>;
}

// plugins/DataTransformPlugin.ts
export class DataTransformPlugin implements SyncPlugin {
  name = 'data-transform';
  version = '1.0.0';

  async beforeSync(tableName: string, data: any[]): Promise<any[]> {
    // –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    if (tableName === 'products') {
      return data.map(product => ({
        ...product,
        price: parseFloat(product.price) || 0,
        created_at: new Date(product.created_at).toISOString()
      }));
    }
    
    return data;
  }

  async afterSync(tableName: string, result: TableSyncResult): Promise<void> {
    console.log(`üîÑ DataTransform: –û–±—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ ${tableName}, –∑–∞–ø–∏—Å–µ–π: ${result.recordsInserted}`);
  }
}

// –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π SyncUtils —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤
export class PluggableSyncUtils extends SyncUtils {
  private plugins: SyncPlugin[] = [];

  addPlugin(plugin: SyncPlugin): void {
    this.plugins.push(plugin);
    console.log(`üîå –ü–æ–¥–∫–ª—é—á–µ–Ω –ø–ª–∞–≥–∏–Ω: ${plugin.name} v${plugin.version}`);
  }

  private async runBeforeSyncPlugins(tableName: string, data: any[]): Promise<any[]> {
    let processedData = data;
    
    for (const plugin of this.plugins) {
      if (plugin.beforeSync) {
        processedData = await plugin.beforeSync(tableName, processedData);
      }
    }
    
    return processedData;
  }

  private async runAfterSyncPlugins(tableName: string, result: TableSyncResult): Promise<void> {
    for (const plugin of this.plugins) {
      if (plugin.afterSync) {
        await plugin.afterSync(tableName, result);
      }
    }
  }
}
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```typescript
// strategies/SyncStrategy.ts
export interface SyncStrategy {
  name: string;
  shouldSync(tableName: string, localVersion: string, serverVersion: string): boolean;
  processSyncResult(result: TableSyncResult): TableSyncResult;
}

// strategies/TimestampBasedStrategy.ts
export class TimestampBasedStrategy implements SyncStrategy {
  name = 'timestamp-based';

  shouldSync(tableName: string, localVersion: string, serverVersion: string): boolean {
    const localTime = new Date(localVersion).getTime();
    const serverTime = new Date(serverVersion).getTime();
    
    return serverTime > localTime;
  }

  processSyncResult(result: TableSyncResult): TableSyncResult {
    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    return {
      ...result,
      metadata: {
        strategy: this.name,
        syncTime: new Date().toISOString()
      }
    };
  }
}

// strategies/ConflictResolutionStrategy.ts
export class ConflictResolutionStrategy implements SyncStrategy {
  name = 'conflict-resolution';

  shouldSync(): boolean {
    return true; // –í—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
  }

  processSyncResult(result: TableSyncResult): TableSyncResult {
    // –õ–æ–≥–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    return result;
  }

  async resolveConflicts(localRecord: any, serverRecord: any): Promise<any> {
    // Server wins —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
    if (serverRecord.updated_at > localRecord.updated_at) {
      return serverRecord;
    }
    
    // Merge —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
    return {
      ...localRecord,
      ...serverRecord,
      notes: [localRecord.notes, serverRecord.notes].filter(Boolean).join('\n')
    };
  }
}
```

### WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```typescript
// services/RealtimeSyncService.ts
export class RealtimeSyncService {
  private ws: WebSocket | null = null;
  private syncUtils: SyncUtils;
  private reconnectAttempts = 0;
  private maxReconnectAttempts = 5;

  constructor(syncUtils: SyncUtils, wsUrl: string) {
    this.syncUtils = syncUtils;
    this.connect(wsUrl);
  }

  private connect(wsUrl: string): void {
    try {
      this.ws = new WebSocket(wsUrl);
      
      this.ws.onopen = () => {
        console.log('üîó WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        this.reconnectAttempts = 0;
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
        this.ws?.send(JSON.stringify({
          type: 'subscribe',
          tables: ['users', 'orders', 'products']
        }));
      };

      this.ws.onmessage = (event) => {
        this.handleMessage(JSON.parse(event.data));
      };

      this.ws.onclose = () => {
        console.log('üîó WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
        this.attemptReconnect(wsUrl);
      };

      this.ws.onerror = (error) => {
        console.error('‚ùå WebSocket –æ—à–∏–±–∫–∞:', error);
      };

    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket:', error);
      this.attemptReconnect(wsUrl);
    }
  }

  private handleMessage(message: any): void {
    switch (message.type) {
      case 'table_updated':
        this.handleTableUpdate(message.tableName, message.changes);
        break;
        
      case 'full_sync_required':
        this.handleFullSyncRequired(message.tables);
        break;
        
      case 'server_notification':
        this.handleServerNotification(message.notification);
        break;
    }
  }

  private async handleTableUpdate(tableName: string, changes: any): Promise<void> {
    console.log(`üîÑ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: ${tableName}`);
    
    try {
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
      if (changes.inserted?.length > 0) {
        await this.syncUtils.applyInserts(tableName, changes.inserted);
      }
      
      if (changes.updated?.length > 0) {
        await this.syncUtils.applyUpdates(tableName, changes.updated);
      }
      
      if (changes.deleted?.length > 0) {
        await this.syncUtils.applyDeletes(tableName, changes.deleted);
      }
      
      // –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
      this.notifyComponents(tableName, changes);
      
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è real-time –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è ${tableName}:`, error);
      // Fallback –Ω–∞ –ø–æ–ª–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
      await this.syncUtils.syncTable(tableName);
    }
  }

  private async handleFullSyncRequired(tables: string[]): Promise<void> {
    console.log('üîÑ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü:', tables);
    
    for (const tableName of tables) {
      await this.syncUtils.syncTable(tableName);
    }
  }

  private handleServerNotification(notification: any): void {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    console.log('üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞:', notification);
    
    // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å toast, –æ–±–Ω–æ–≤–∏—Ç—å UI –∏ —Ç.–¥.
    if (window.showNotification) {
      window.showNotification(notification.message, notification.type);
    }
  }

  private attemptReconnect(wsUrl: string): void {
    if (this.reconnectAttempts < this.maxReconnectAttempts) {
      this.reconnectAttempts++;
      const delay = Math.pow(2, this.reconnectAttempts) * 1000; // Exponential backoff
      
      console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ${this.reconnectAttempts}/${this.maxReconnectAttempts} —á–µ—Ä–µ–∑ ${delay}–º—Å`);
      
      setTimeout(() => {
        this.connect(wsUrl);
      }, delay);
    } else {
      console.error('‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–µ–≤—ã—à–µ–Ω–æ');
    }
  }

  private notifyComponents(tableName: string, changes: any): void {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º custom event –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    window.dispatchEvent(new CustomEvent('realtime-update', {
      detail: { tableName, changes }
    }));
  }

  disconnect(): void {
    if (this.ws) {
      this.ws.close();
      this.ws = null;
    }
  }
}

// –•—É–∫ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
export const useRealtimeSync = (config: SyncConfig) => {
  const syncData = useSyncData(config);
  const [realtimeService, setRealtimeService] = useState<RealtimeSyncService | null>(null);

  useEffect(() => {
    if (syncData.isInitialized && !realtimeService) {
      const wsUrl = config.apiBaseUrl?.replace('http', 'ws') + '/ws';
      const service = new RealtimeSyncService(syncData.syncUtils, wsUrl);
      setRealtimeService(service);
    }

    return () => {
      realtimeService?.disconnect();
    };
  }, [syncData.isInitialized, config.apiBaseUrl]);

  // –°–ª—É—à–∞–µ–º real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  useEffect(() => {
    const handleRealtimeUpdate = (event: CustomEvent) => {
      const { tableName, changes } = event.detail;
      console.log(`üîÑ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ: ${tableName}`, changes);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      syncData.refreshTableData(tableName);
    };

    window.addEventListener('realtime-update', handleRealtimeUpdate as EventListener);
    
    return () => {
      window.removeEventListener('realtime-update', handleRealtimeUpdate as EventListener);
    };
  }, [syncData]);

  return {
    ...syncData,
    isRealtimeConnected: realtimeService !== null
  };
};
```

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ IndexedDB –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π offline-—Ä–µ–∂–∏–º–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö.

### üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
- **üîß –ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞  
- **üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- **üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- **üé® Developer Experience** - TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏–π

### üîÆ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- **GraphQL –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GraphQL subscriptions
- **Multi-tenant –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
- **–ö–æ–º–ø—Ä–µ—Å—Å–∏—è –¥–∞–Ω–Ω—ã—Ö** - —Å–∂–∞—Ç–∏–µ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- **ML-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting** –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
2. **–ò–∑—É—á–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è best practices  
3. **–°–æ–∑–¥–∞–π—Ç–µ issue** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è bug reports
4. **–û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º** –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∏ –º—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤! üöÄ